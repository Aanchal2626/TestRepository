<!DOCTYPE html>
<html lang="zxx" class="js">
  <head>
    <base href="../" />
    <meta charset="utf-8" />
    <meta name="author" content="Softnio" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="A powerful and conceptual apps base dashboard template that especially build for developers and programmers." />
    <!-- Fav Icon  -->
    <link rel="shortcut icon" href="/app/assets/images/favicon.png" />
    <!-- Page Title  -->
    <title>Dashboard | Document Controller</title>
    <!-- StyleSheets  -->
    <link rel="stylesheet" href="/app/assets/css/dashlite.css" />
    <link id="skin-default" rel="stylesheet" href="/app/assets/css/theme.css" />
    <style>
      .amount {
        font-size: 15px !important;
      }
    </style>
  </head>

  <body class="nk-body bg-lighter npc-general has-sidebar">
    <div class="nk-app-root">
      <div class="nk-main">
        <%- include('./common/sidebar' , {active : "Dashboard"}); -%>
        <div class="nk-wrap">
          <%- include('./common/navbar'); -%>
          <div class="nk-content">
            <div class="container-fluid">
              <div class="nk-content-inner">
                <div class="nk-content-body">
                  <div class="nk-block-head nk-block-head-sm">
                    <div class="nk-block-between">
                      <div class="nk-block-head-content d-flex">
                        <h3 class="nk-block-title page-title">Welcome <%=token.user_name%></h3>
                        <div class="nk-block-des text-soft" style="font-size: 30px; position: relative; left: 5px; bottom: 15px">ðŸ‘‹</div>
                      </div>
                      <div class="nk-block-head-content">
                        <div class="toggle-wrap nk-block-tools-toggle">
                          <a href="#" class="btn btn-icon btn-trigger toggle-expand me-n1" data-target="pageMenu"><em class="icon ni ni-more-v"></em></a>
                          <!-- <div class="toggle-expand-content" data-content="pageMenu">
                            <ul class="nk-block-tools g-3">
                              <li class="nk-block-tools-opt">
                                <a href="#" class="btn btn-primary"><em class="icon ni ni-reports"></em><span>Reports</span></a>
                              </li>
                            </ul>
                          </div> -->
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="nk-block">
                    <div class="row g-gs">
                      <div class="col-lg-12">
                        <div class="card card-bordered h-100">
                          <div class="card-inner">
                            <div class="card-title-group pb-3 g-2">
                              <div class="card-title card-title-sm">
                                <h6 class="title">Documents Overview</h6>
                              </div>
                              <div class="card-tools shrink-0 d-none d-sm-block">
                                <select name="statsSiteFilter" id="statsSiteFilter" class="form-select form-control js-select2 form-control" data-search="on">
                                  <% sites.forEach(function(site){ %>
                                  <option value="<%= site.site_id %>"><%= site.site_name %></option>
                                  <% }); %>
                                </select>
                              </div>
                            </div>
                            <div class="analytic-ov" id="folderStats">
                              <div class="analytic-data-group analytic-ov-group g-3">
                                <div class="analytic-data analytic-ov-data">
                                  <div class="title">Folder Name</div>
                                  <div class="amount">-</div>
                                </div>
                                <div class="analytic-data analytic-ov-data">
                                  <div class="title">Total Documents</div>
                                  <div class="amount">-</div>
                                </div>
                                <div class="analytic-data analytic-ov-data">
                                  <div class="title">Drafted Documents</div>
                                  <div class="amount">-</div>
                                </div>
                                <div class="analytic-data analytic-ov-data">
                                  <div class="title">Uploaded Documents</div>
                                  <div class="amount">-</div>
                                </div>
                                <div class="analytic-data analytic-ov-data">
                                  <div class="title">Pages Uploaded</div>
                                  <div class="amount">-</div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <!-- .card -->
                      </div>
                      <div class="col-lg-6 col-xxl-4">
                        <div class="card card-bordered h-100">
                          <div class="card-inner border-bottom">
                            <div class="card-title-group">
                              <div class="card-title">
                                <h6 class="title">Road Map (Current Features)</h6>
                              </div>
                            </div>
                          </div>
                          <div class="card-inner">
                            <div class="timeline">
                              <h6 class="timeline-head">Dec 2023 - Feb 2024</h6>
                              <ul class="timeline-list">
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-success">Done</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Auto Generated Document Number</h6>
                                  </div>
                                </li>
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-success">Done</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Document Drafting</h6>
                                  </div>
                                </li>
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-success">Done</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Document Uploading</h6>
                                  </div>
                                </li>
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-success">Done</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Automatic Document Scanning via ocr</h6>
                                  </div>
                                </li>
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-success">Done</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Document Searching</h6>
                                  </div>
                                </li>

                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-success">Done</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Document Stage for Tracking History</h6>
                                  </div>
                                </li>
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-success">Done</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Multi User</h6>
                                  </div>
                                </li>
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-success">Done</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Multi Sites (Sub Folders in Sites)</h6>
                                  </div>
                                </li>
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-success">Done</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Import Via Excel</h6>
                                  </div>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-6 col-xxl-4">
                        <div class="card card-bordered h-100">
                          <div class="card-inner border-bottom">
                            <div class="card-title-group">
                              <div class="card-title">
                                <h6 class="title">Road Map (Upcoming Features)</h6>
                              </div>
                            </div>
                          </div>
                          <div class="card-inner">
                            <div class="timeline">
                              <h6 class="timeline-head">Feb 2024</h6>
                              <ul class="timeline-list">
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-primary">Upcoming</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Import Via Email</h6>
                                  </div>
                                </li>
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-primary">Upcoming</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Outgoing Letter Stages (Dipatched, Cancelled)</h6>
                                  </div>
                                </li>
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-primary">Upcoming</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Incoming Letter Stages (Pending Actions, Actions Completed)</h6>
                                  </div>
                                </li>
                                <li class="timeline-item">
                                  <div class="timeline-status bg-primary is-outline"></div>
                                  <div class="timeline-date text-primary">Upcoming</div>
                                  <div class="timeline-data">
                                    <h6 class="timeline-title">Report Generation</h6>
                                  </div>
                                </li>
                              </ul>
                            </div>
                          </div>
                        </div>
                        <!-- .card -->
                      </div>
                      <!-- .col -->
                    </div>
                    <!-- .row -->
                  </div>
                  <!-- .nk-block -->
                </div>
              </div>
            </div>
          </div>
          <%- include('./common/footer'); -%>
        </div>
      </div>
    </div>
    <script src="/app/assets/js/bundle.js"></script>
    <script src="/app/assets/js/scripts.js"></script>
    <script src="/app/assets/js/charts/gd-default.js"></script>
    <script>
      $("#statsSiteFilter").change(function () {
        fetchDashboardStats();
      });
      function fetchDashboardStats() {
        let site = $("#statsSiteFilter").val();
        $.ajax({
          url: "/dashboard/site-stats",
          type: "POST",
          contentType: "application/json",
          data: JSON.stringify({ site_id: site }),
          success: function (response) {
            if (response.status == 1) {
              let htmlString = ``;

              response.documentStatsPerFolder.forEach(function (folder) {
                folder.siteName = folder.siteName.split(" - ").pop();
                htmlString += ` <div class="analytic-data-group analytic-ov-group g-3">
                                <div class="analytic-data analytic-ov-data">
                                  <div class="title">Folder Name</div>
                                  <div class="amount">${folder.siteName || "-"}</div>
                                </div>
                                <div class="analytic-data analytic-ov-data">
                                  <div class="title">Total Documents</div>
                                  <div class="amount">${folder.stats.totalDocuments || "-"}</div>
                                </div>
                                <div class="analytic-data analytic-ov-data">
                                  <div class="title">Drafted Documents</div>
                                  <div class="amount">${folder.stats.draftedDocuments || "-"}</div>
                                </div>
                                <div class="analytic-data analytic-ov-data">
                                  <div class="title">Uploaded Documents</div>
                                  <div class="amount">${folder.stats.uploadedDocuments || "-"}</div>
                                </div>
                                <div class="analytic-data analytic-ov-data">
                                  <div class="title">Pages Uploaded</div>
                                  <div class="amount">${folder.stats.pagesUploaded || "-"}</div>
                                </div>
                              </div>`;
              });
              $("#folderStats").html(htmlString);
            } else {
              $("#folderStats").html("<p>No data available</p>");
            }
          },
          error: function (xhr, status, error) {
            $("#folderStats").html("<p>Error loading data</p>");
            console.error(error);
          },
        });
      }
      fetchDashboardStats();
    </script>
  </body>
</html>
